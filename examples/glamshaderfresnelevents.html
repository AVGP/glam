<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="../libs/jquery-1.9.1/jquery-1.9.1.js"></script>
<script src="../libs/parsecss/jquery.parsecss.js" ></script>
<script src="../libs/vizi/vizi.js" ></script>
<script src="../src/glam.js" ></script>
<script src="../src/node.js" ></script>
<script src="../src/parser.js" ></script>
<script src="../src/cube.js" ></script>
<script src="../src/cone.js" ></script>
<script src="../src/cylinder.js" ></script>
<script src="../src/sphere.js" ></script>
<script src="../src/group.js" ></script>
<script src="../src/material.js" ></script>
<script src="../src/transform.js" ></script>
<script src="../src/animation.js" ></script>
<script src="../src/background.js" ></script>
<script src="../src/viewer.js" ></script>
<title>glam - fresnel shader</title>

<style>

	.skybox {
		envmap-right:url(../images/Park2/posx.jpg);
		envmap-left:url(../images/Park2/negx.jpg);
		envmap-top:url(../images/Park2/posy.jpg);
		envmap-bottom:url(../images/Park2/negy.jpg);
		envmap-front:url(../images/Park2/posz.jpg);
		envmap-back:url(../images/Park2/negz.jpg);
	}
	
	.bubble {
		radius:.5;
		color-diffuse:lightgray;
		shader-vertex:url(../shaders/fresnel.vs);
		shader-fragment:url(../shaders/fresnel.fs);
		shader-uniforms:mRefractionRatio f 1.02 mFresnelBias f 0.1 mFresnelPower f 2.0 mFresnelScale f 1.0 tCube t null;
	}

	#sb1 {
		background-type:box;
	}
	
</style>
<script>

var pop = null;

function createBubble(doc, scene, x, y, z, animClass) {
	var groupelt = doc.createElement('group');
	
	groupelt.setAttribute('x', x);
	groupelt.setAttribute('z', z);
	groupelt.setAttribute('y', y);

	var sphereelt = doc.createElement('sphere');
	sphereelt.setAttribute('class', "bubble skybox");

	sphereelt.addEventListener("click", function(event) {
		pop.play();
		scene.removeChild(groupelt);
	});

	sphereelt.setAttribute('animation', animClass);

	groupelt.appendChild(sphereelt);
		
	return groupelt;
}

function addBubbles(doc, scene) {

	pop = document.getElementById("pop");
	
	var i, len = 50;

	for (i = 0; i < len; i++) {

		var x = -6 + (Math.random() * 12);
		var y = -6 + (Math.random() * 12);
		var z = -6 + (Math.random() * 12);

		var animClass = i % 3 ? 'bubbleBounce' : (i % 2 ? 'bubbleBounce2' : 'bubbleBounce3');
		var groupelt = createBubble(doc, scene, x, y, z, animClass);
		
		scene.appendChild(groupelt);
		
	}
}

$(document).ready(function(){

	glam.ready();
		
	var doc = glam.documents.glam1;
	var scene = doc.getElementsByTagName('scene')[0];
	addBubbles(doc, scene);

});

</script>
</head>
<body>
<!--  Audio file  
	http://freesound.org/people/Godowan/sounds/235264/
-->
<audio volume="1" id="pop">
  <source src="../sounds/235264__godowan__bubble1_trimmed.wav" type="audio/wav" />
  Your browser does not support WAV files in the audio element.
</audio>
<!-- 
glam - Simple scene with cube
 -->
<div id="container" style="width:98%; height:98%;position:absolute;">
<script id="glam1" type="text/glam">
<glam>
  <scene>
	<background id="sb1" class="skybox"/>
  	<animation id="bubbleBounce" duration="20s" iteration-count="infinite" timing-function="ease-in-out">
		<frame time="0%" property="transform" value="translateY(-6);"/>
		<frame time="50%" property="transform" value="translateY(0);"/>
		<frame time="100%" property="transform" value="translateY(6);"/>
	</animation>
  	<animation id="bubbleBounce2" duration="5s" iteration-count="infinite" timing-function="ease-in-out">
		<frame time="0%" property="transform" value="translateY(0);"/>
		<frame time="50%" property="transform" value="translateY(2);"/>
		<frame time="100%" property="transform" value="translateY(0);"/>
	</animation>
  	<animation id="bubbleBounce3" duration="8s" iteration-count="infinite" timing-function="ease-in-out">
		<frame time="0%" property="transform" value="translateX(-2);"/>
		<frame time="50%" property="transform" value="translateX(0);"/>
		<frame time="100%" property="transform" value="translateX(-2);"/>
	</animation>
  </scene>
</glam>
</script>
</div>

</body>
</html>